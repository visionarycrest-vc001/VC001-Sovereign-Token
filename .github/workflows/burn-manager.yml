---
name: "🔥 Burn Manager Protocol"

"on":
  workflow_dispatch:
    inputs:
      token_id:
        description: 'Token ID to burn'
        required: true
      burn_reason:
        description: 'Reason for burning'
        required: true
        default: 'Ceremonial retirement'
  issue_comment:
    types: [created]

jobs:
  burn-ceremony:
    if: contains(github.event.comment.body, '/burn-token') || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm install
        
      - name: Verify Burn Authority
        run: |
          echo "🛡️ Verifying burn authority and token ownership..."
          # Ceremonial authority validation for token burning
          
      - name: Execute Burn Ceremony
        run: |
          echo "🔥 Initiating token burn ceremony..."
          node scripts/burnNFT.js ${{ github.event.inputs.token_id }}
          
      - name: Record Burn Transaction
        run: |
          echo "📜 Recording burn ceremony in sovereign ledger..."
          echo "### Token Burn Ceremony - $(date -u)" >> data/burn-registry.md
          echo "- Token ID: ${{ github.event.inputs.token_id }}" >> data/burn-registry.md
          echo "- Reason: ${{ github.event.inputs.burn_reason }}" >> data/burn-registry.md
          echo "- Burned by: ${{ github.actor }}" >> data/burn-registry.md
          echo "- Status: ⚱️ Ceremonially retired" >> data/burn-registry.md
          
      - name: Update Supply Metrics
        run: |
          echo "📊 Updating total supply after burn ceremony..."
          # Update circulating supply metrics
          
      - name: Inscribe Burn Lineage
        run: |
          echo "🔥 Inscribing burn ceremony to crest lineage..."
          echo "- Token ${{ github.event.inputs.token_id }} ceremonially burned $(date -u)" >> docs/lineage/Burn_Lineage.md
          
      - name: Notify Stewards
        run: |
          echo "📢 Notifying sovereign stewards of burn ceremony..."
          echo "Token burn ceremony completed for ID: ${{ github.event.inputs.token_id }}"
          
      - name: Commit Burn Artifacts
        run: |
          git config user.name "Burn Steward"
          git config user.email "security@visionarycrest.org"
          git add data/ docs/lineage/
          git commit -m "🔥 Burn Ceremony: Token ${{ github.event.inputs.token_id }} ceremonially retired" || exit 0
          git push origin main